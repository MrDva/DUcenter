<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ithujiaze.dao.Three_DataTableMapper">
    <resultMap id="BaseResultMap" type="com.ithujiaze.entity.Three_Data">
        <id column="Access_id" property="access_id"></id>
        <result column="Mac" property="mac"></result>
        <result column="Address" property="address"></result>
        <result column="Datetime" property="datetime"></result>
        <association property="user" javaType="com.ithujiaze.entity.User">
            <id column="User_Id" property="user_Id"/>
            <result column="Phone" property="phone"/>
            <result column="Password" property="password"/>
            <result column="Affiliation" property="affiliation"/>
            <result column="Username" property="username"/>
            <result column="Is_Delete" property="is_Delete"/>
            <result column="Is_Login" property="is_Login"/>
            <association property="role" javaType="com.ithujiaze.entity.Role">
                <id column="Role_Id" property="role_Id"/>
                <result column="Role_Name" property="role_Name"/>
                <result column="Role_Level" property="role_Level"/>
                <collection property="authoritys" ofType="com.ithujiaze.entity.Authority">
                    <id column="Authority_Id" property="authority_Id"/>
                    <result column="Authority_Name" property="authority_Name"/>
                </collection>
            </association>
        </association>
    </resultMap>



    <select id="GetThree_DataById" parameterType="int" resultMap="BaseResultMap">
       select t.*,u.username,u.phone from three_login_table as t ,user_table as u where t.user_id=u.user_id  and t.user_id=#{id} order by t.datetime desc
    </select>

    <select id="GetThree_DataByIdGroupByCount" parameterType="int"  resultType="com.ithujiaze.entity.Three_DateCount">
        select t.Mac,t.Datetime,u.username,u.phone,COUNT(*) as COUNT from three_login_table as t ,
        user_table as u where t.user_id=u.user_id  and t.user_id=#{id} GROUP BY Mac order by COUNT(*) DESC
    </select>

    <select id="GetThree_DataByAddress" resultMap="BaseResultMap" parameterType="String">
        select l.*,u.username,u.phone from three_login_table as l ,user_table as u where l.address like #{address}
        and l.user_id=u.user_id order by l.datetime desc
    </select>

    <select id="GetThree_DataByAddressNowDay" resultMap="BaseResultMap" parameterType="String">
        select l.*,u.username,u.phone  from three_login_table as l ,user_table as u  where l.address like #{address}
         and l.user_id=u.user_id
         and to_days(l.Datetime) = to_days(now()) order by l.datetime asc
    </select>

    <select id="GetThree_DataByAddressSevenDay" resultMap="BaseResultMap" parameterType="String">
        select l.*,u.username,u.phone from three_login_table as l ,user_table as u  where l.address like #{address}
        and l.user_id=u.user_id
        and DATE_SUB(CURDATE(), INTERVAL 7 DAY) &lt;= date(l.datetime)  order by l.datetime asc
    </select>

    <select id="GetThree_DataByAddressOneMonth" resultMap="BaseResultMap" parameterType="String">
        select l.*,u.username,u.phone from three_login_table as l ,user_table as u  where l.address like #{address}
        and l.user_id=u.user_id
        and DATE_SUB(CURDATE(), INTERVAL 30 DAY) &lt;= date(l.datetime)  order by l.datetime asc
    </select>

    <insert id="insert" parameterType="com.ithujiaze.entity.Three_Data">
        insert into three_login_table(User_Id,Mac,Address,Datetime)
         values (#{user.user_Id},#{mac},#{address},#{datetime})
    </insert>

    <delete id="DeleteThree_DataByThreeMonth">
         delete from three_login_table where DATE_SUB(CURDATE(), INTERVAL 90 DAY) &gt;= date(Datetime)
    </delete>
</mapper>